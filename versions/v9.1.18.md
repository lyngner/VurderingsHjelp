
# Oppdatering v9.1.18 - Pre-emptive JSON Sweep

Denne oppdateringen l√∏ser de vanskelige "Bad escaped character" feilene i JSON ved √• bruke en ny tiln√¶rming som ikke er avhengig av `JSON.parse`.

### üõ°Ô∏è Kritiske Feilrettinger:

1.  **Tokenize-Escape-Restore (Pre-emptive Sweep)**:
    *   **Problemet:** Tidligere fors√∏k p√• √• reparere JSON feilet fordi de pr√∏vde √• gjette hvor feilen var *etter* at parsing feilet, eller brukte regex som var for aggressiv/svak.
    *   **L√∏sningen:** F√∏r vi i det hele tatt pr√∏ver √• parse JSON-strengen, kj√∏rer vi en "vask":
        1.  Vi finner alle *gyldige* escape-sekvenser (`\n`, `\"`, `\\`, `\t` etc.) og erstatter dem midlertidig med unike tokens (f.eks. `@@@JSON_ESCAPE_N@@@`).
        2.  Vi tar alle *resterende* backslasher (som er ugyldige, f.eks. i `\sigma` eller `\begin`) og escaper dem (`\\`).
        3.  Vi setter tilbake de lovlige kodene vi gjemte unna.
    *   **Resultat:** LaTeX-kode som `\sigma` blir til `\\sigma` (som er gyldig JSON), mens `\n` forblir `\n` (som ogs√• er gyldig). `JSON.parse` leser dette perfekt.

2.  **Unntak for `\b` og `\f`**:
    *   I math-kontekst betyr `\b` nesten alltid `\begin`, ikke backspace. Vi beskytter derfor *ikke* `\b` som en gyldig escape, men lar den bli `\\b` (teksten "\b"), slik at `\begin` overlever.

### Teknisk:
*   Total ombygging av `cleanJson` i `geminiService.ts`.
*   Systemversjon: **v9.1.18**.
