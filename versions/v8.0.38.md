
# Oppdatering v8.0.38 - Strict JSON Escaping Fix (The "Begin" Bug)

Denne oppdateringen l√∏ser en kritisk feil der LaTeX-koder som `\begin` ble √∏delagt av JSON-parsing ("Math input error"), fordi Gemini Flash noen ganger glemmer √• dobbel-escape backslash.

### üõ°Ô∏è Kritiske endringer:

1.  **JSON Escape Repair**:
    *   **Problemet:** Hvis KI-en returnerer `"\begin{aligned}"` (√©n backslash), tolker `JSON.parse` `\b` som et backspace-tegn. Resultatet blir ` egin{aligned}` (e-en slettes eller blir rar), og MathJax krasjer.
    *   **L√∏sningen:** Funksjonen `cleanJson` scanner n√• den r√• tekststrengen *f√∏r* parsing. Den finner spesifikke LaTeX-kommandoer (`\begin`, `\text`, `\frac`) som kolliderer med JSON-kontrolltegn (`\b`, `\t`, `\f`) og setter inn den manglende backslashen automatisk.
    *   **Resultat:** `\begin` blir til `\\begin`, som parses korrekt til `\begin` i minnet.

2.  **Frontend Fallback (Hydration Repair)**:
    *   For eksisterende data som allerede er lagret feil (f.eks. ` egin{aligned}`), har `LatexRenderer` f√•tt en "Sanitizer"-regel som automatisk gjenoppretter `\begin{` fra den √∏delagte teksten.
    *   Dette gj√∏r at gamle feil "forsvinner" visuelt uten at man m√• transkribere p√• nytt.

3.  **Strict Mandate**:
    *   Lagt til Regel 46 i `TECHNICAL_STANDARD.md`: "Strict JSON Escaping for LaTeX".
    *   Oppdatert systeminstruksen til √• eksplisitt be om `\\begin` (dobbel backslash).

### Teknisk:
*   Oppdatert `geminiService.ts` med forbedret `cleanJson` regex.
*   Oppdatert `SharedUI.tsx` med repair-logikk i `LatexRenderer`.
*   Systemversjon: **v8.0.38**.
